temp <- read.csv(url,header=T)
data.list[[i]] <- temp
}
}
povcal.threshold.all()
povcal.threshold.all <- function(year="all",TargetHC=0.01,Lowerguess=0, Upperguess=10){
data.list <- list()
PLs <- seq(Lowerguess,Upperguess,by=0.01)
for (i in 1:length(PLs)){
param <- paste0("Countries=all&RefYears=",year,"&PovertyLine=",PLs[i],"&display=a")
url <- paste0("http://iresearch.worldbank.org/PovcalNet/PovcalNetAPI.ashx?",param,"&display=c")
temp <- read.csv(url,header=T)
data.list[[i]] <- temp
}
}
povcal.threshold.all()
povcal.threshold.all <- function(year="all",TargetHC=0.01,Lowerguess=0, Upperguess=10){
data.list <- list()
PLs <- seq(Lowerguess,Upperguess,by=0.01)
pb <- txtProgressBar(min=0, max=length(PLs),style=3)
for (i in 1:length(PLs)){
param <- paste0("Countries=all&RefYears=",year,"&PovertyLine=",PLs[i],"&display=a")
url <- paste0("http://iresearch.worldbank.org/PovcalNet/PovcalNetAPI.ashx?",param,"&display=c")
temp <- read.csv(url,header=T)
data.list[[i]] <- temp
setTxtProgressBar(pb,i)
}
return(data.list)
close(pb)
}
povcal.threshold.all()
povcal.threshold.all <- function(year="all",TargetHC=0.01,Lowerguess=0, Upperguess=1){
data.list <- list()
PLs <- seq(Lowerguess,Upperguess,by=0.01)
pb <- txtProgressBar(min=0, max=length(PLs),style=3)
for (i in 1:length(PLs)){
param <- paste0("Countries=all&RefYears=",year,"&PovertyLine=",PLs[i],"&display=a")
url <- paste0("http://iresearch.worldbank.org/PovcalNet/PovcalNetAPI.ashx?",param,"&display=c")
temp <- read.csv(url,header=T)
data.list[[i]] <- temp
setTxtProgressBar(pb,i)
}
return(data.list)
close(pb)
}
povcal.threshold.all()
data <- .Last.value
View(data)
data <- rbind(data.list)
data <- rbindlist(data)
View(data)
?abs
data$diff <- abs(TargetHC-data$hc)
data$diff <- abs(0.01-data$hc)
data.agg <- aggregate(data,by=list(data$requestYear),FUN=min)
data.agg <- data[,c(1,4,10)]
data.agg <- aggregate(data.agg,by=list(data$requestYear),FUN=min)
View(data.agg)
data.agg <- data[,c(1,4,10)]
data.agg <- aggregate(data.agg,by=list(data$requestYear,data$povertyLine),FUN=min)
data2015 <- data[which(requestYear==2015&data$diff==min(data[which(requestYear==2015)]$diff))]
View(data2015)
for(year in unique(data$requestYear)){
datatemp[year] <- data[which(requestYear==year&data$diff==min(data[which(requestYear==year)]$diff))]
}
datatemp <- list()
for(year in unique(data$requestYear)){
datatemp[year] <- data[which(requestYear==year&data$diff==min(data[which(requestYear==year)]$diff))]
}
warnings()
View(datatemp)
datatemp <- list()
for(year in unique(data$requestYear)){
datatemp[year-1980] <- data[which(requestYear==year&data$diff==min(data[which(requestYear==year)]$diff))]
}
View(datatemp)
datatemp <- list()
for(year in unique(data$requestYear)){
datatemp[[year-1980]] <- data[which(requestYear==year&data$diff==min(data[which(requestYear==year)]$diff))]
}
View(datatemp)
thresholds <- rbindlist(datatemp)
View(thresholds)
povcal.threshold.all <- function(TargetHC=0.01,year="all",Lowerguess=0, Upperguess=1){
data.list <- list()
PLs <- seq(Lowerguess,Upperguess,by=0.01)
pb <- txtProgressBar(min=0, max=length(PLs),style=3)
for (i in 1:length(PLs)){
param <- paste0("Countries=all&RefYears=",year,"&PovertyLine=",PLs[i],"&display=a")
url <- paste0("http://iresearch.worldbank.org/PovcalNet/PovcalNetAPI.ashx?",param,"&display=c")
temp <- read.csv(url,header=T)
data.list[[i]] <- temp
setTxtProgressBar(pb,i)
}
close(pb)
data <- rbindlist(data.list)
data$diff <- abs(TargetHC-data$hc)
datatemp <- list()
for(year in unique(data$requestYear)){
datatemp[[year-1980]] <- data[which(requestYear==year&data$diff==min(data[which(requestYear==year)]$diff))]
}
thresholds <- rbindlist(datatemp)
return(thresholds)
}
rm(list=ls())
povcal.threshold.all <- function(TargetHC=0.01,year="all",Lowerguess=0, Upperguess=1){
data.list <- list()
PLs <- seq(Lowerguess,Upperguess,by=0.01)
pb <- txtProgressBar(min=0, max=length(PLs),style=3)
for (i in 1:length(PLs)){
param <- paste0("Countries=all&RefYears=",year,"&PovertyLine=",PLs[i],"&display=a")
url <- paste0("http://iresearch.worldbank.org/PovcalNet/PovcalNetAPI.ashx?",param,"&display=c")
temp <- read.csv(url,header=T)
data.list[[i]] <- temp
setTxtProgressBar(pb,i)
}
close(pb)
data <- rbindlist(data.list)
data$diff <- abs(TargetHC-data$hc)
datatemp <- list()
for(year in unique(data$requestYear)){
datatemp[[year-1980]] <- data[which(requestYear==year&data$diff==min(data[which(requestYear==year)]$diff))]
}
thresholds <- rbindlist(datatemp)
return(thresholds)
}
data <- povcal.threshold.all(0.01,"all",0,1)
View(data)
povcal.threshold.all <- function(TargetHC=0.01,year="all",Lowerguess=0.2, Upperguess=1,precision=0.005){
data.list <- list()
PLs <- seq(Lowerguess,Upperguess,by=precision)
pb <- txtProgressBar(min=0, max=length(PLs),style=3)
for (i in 1:length(PLs)){
param <- paste0("Countries=all&RefYears=",year,"&PovertyLine=",PLs[i],"&display=a")
url <- paste0("http://iresearch.worldbank.org/PovcalNet/PovcalNetAPI.ashx?",param,"&display=c")
temp <- read.csv(url,header=T)
data.list[[i]] <- temp
setTxtProgressBar(pb,i)
}
close(pb)
data <- rbindlist(data.list)
data$diff <- abs(TargetHC-data$hc)
datatemp <- list()
for(year in unique(data$requestYear)){
datatemp[[year-1980]] <- data[which(requestYear==year&data$diff==min(data[which(requestYear==year)]$diff))]
}
thresholds <- rbindlist(datatemp)
return(thresholds)
}
povcal.threshold.all <- function(TargetHC,year="all",Lowerguess=0, Upperguess=10,precision=0.005){
data.list <- list()
PLs <- seq(Lowerguess,Upperguess,by=precision)
pb <- txtProgressBar(min=0, max=length(PLs),style=3)
for (i in 1:length(PLs)){
param <- paste0("Countries=all&RefYears=",year,"&PovertyLine=",PLs[i],"&display=a")
url <- paste0("http://iresearch.worldbank.org/PovcalNet/PovcalNetAPI.ashx?",param,"&display=c")
temp <- read.csv(url,header=T)
data.list[[i]] <- temp
setTxtProgressBar(pb,i)
}
close(pb)
data <- rbindlist(data.list)
data$diff <- abs(TargetHC-data$hc)
datatemp <- list()
for(year in unique(data$requestYear)){
datatemp[[year-1980]] <- data[which(requestYear==year&data$diff==min(data[which(requestYear==year)]$diff))]
}
thresholds <- rbindlist(datatemp)
return(thresholds)
}
povcal.threshold.all <- function(targetHC,year="all",lowerguess=0, upperguess=10,precision=0.005){
data.list <- list()
PLs <- seq(lowerguess,upperguess,by=precision)
pb <- txtProgressBar(min=0, max=length(PLs),style=3)
for (i in 1:length(PLs)){
param <- paste0("Countries=all&RefYears=",year,"&PovertyLine=",PLs[i],"&display=a")
url <- paste0("http://iresearch.worldbank.org/PovcalNet/PovcalNetAPI.ashx?",param,"&display=c")
temp <- read.csv(url,header=T)
data.list[[i]] <- temp
setTxtProgressBar(pb,i)
}
close(pb)
data <- rbindlist(data.list)
data$diff <- abs(targetHC-data$hc)
datatemp <- list()
for(year in unique(data$requestYear)){
datatemp[[year-1980]] <- data[which(requestYear==year&data$diff==min(data[which(requestYear==year)]$diff))]
}
thresholds <- rbindlist(datatemp)
return(thresholds)
}
data <- povcal.threshold.all(TargetHC=0.01,year="all",Lowerguess=0,Upperguess=1,precision=0.005)
data <- povcal.threshold.all(targetHC=0.01,year="all",lowerguess=0.3,upperguess=0.7,precision=0.005)
P20thresholds <- povcal.threshold.all(targetHC=0.2,year="all",lowerguess=1,upperguess=3,precision=0.005)
View(P20thresholds)
povcal.threshold.national <- function(targetHC,year="all",lowerguess=0, upperguess=10,precision=0.005){
data.list <- list()
PLs <- seq(lowerguess,upperguess,by=precision)
pb <- txtProgressBar(min=0, max=length(PLs),style=3)
for (i in 1:length(PLs)){
param <- paste0("Countries=all&RefYears=",year,"&PovertyLine=",PLs[i],"&display=c")
url <- paste0("http://iresearch.worldbank.org/PovcalNet/PovcalNetAPI.ashx?",param,"&display=c")
temp <- read.csv(url,header=T)
data.list[[i]] <- temp
setTxtProgressBar(pb,i)
}
close(pb)
data <- rbindlist(data.list)
data$diff <- abs(targetHC-data$hc)
datatemp <- list()
for(i in 1:length(unique(data$CountryName))){
for(year in unique(data$requestYear)){
datatemp[[year-1980+36*(i-1)]] <- data[which(CountryName==unique(data$CountryName)[i],requestYear==year&data$diff==min(data[which(requestYear==year)]$diff))]
}
}
thresholds <- rbindlist(datatemp)
return(thresholds)
}
povcal.threshold.national(0.01,"all",0,2,0.01)
povcal.threshold.national <- function(targetHC,year="all",lowerguess=0, upperguess=10,precision=0.005){
data.list <- list()
PLs <- seq(lowerguess,upperguess,by=precision)
pb <- txtProgressBar(min=0, max=length(PLs),style=3)
for (i in 1:length(PLs)){
param <- paste0("Countries=all&RefYears=",year,"&PovertyLine=",PLs[i],"&display=c")
url <- paste0("http://iresearch.worldbank.org/PovcalNet/PovcalNetAPI.ashx?",param,"&display=c")
temp <- read.csv(url,header=T)
data.list[[i]] <- temp
setTxtProgressBar(pb,i)
}
close(pb)
data <- rbindlist(data.list)
data$diff <- abs(targetHC-data$hc)
datatemp <- list()
i <- 1
for(country in (unique(data$CountryName))){
for(year in unique(data$requestYear)){
datatemp[[year-1980+36*(i-1)]] <- data[which(country==unique(data$CountryName)[i],requestYear==year&data$diff==min(data[which(requestYear==year)]$diff))]
}
i = i + 1
}
thresholds <- rbindlist(datatemp)
return(thresholds)
}
povcal.threshold.national(0.01,"all",0,2,0.01)
povcal.threshold.national(0.01,"all",0,2,0.01)
targetHC <- 0.01
year <- "all"
lowerguess <- 0
upperguess <- 2
precision <- 0.01
data.list <- list()
PLs <- seq(lowerguess,upperguess,by=precision)
pb <- txtProgressBar(min=0, max=length(PLs),style=3)
for (i in 1:length(PLs)){
param <- paste0("Countries=all&RefYears=",year,"&PovertyLine=",PLs[i],"&display=c")
url <- paste0("http://iresearch.worldbank.org/PovcalNet/PovcalNetAPI.ashx?",param,"&display=c")
temp <- read.csv(url,header=T)
data.list[[i]] <- temp
setTxtProgressBar(pb,i)
}
close(pb)
data <- rbindlist(data.list)
data$diff <- abs(targetHC-data$hc)
datatemp <- list()
View(data)
View(data.list)
View(data)
povcal.threshold.global <- function(targetHC,year="all",lowerguess=0, upperguess=10,precision=0.005){
data.list <- list()
PLs <- seq(lowerguess,upperguess,by=precision)
pb <- txtProgressBar(min=0, max=length(PLs),style=3)
for (i in 1:length(PLs)){
param <- paste0("Countries=all&RefYears=",year,"&PovertyLine=",PLs[i])
url <- paste0("http://iresearch.worldbank.org/PovcalNet/PovcalNetAPI.ashx?",param,"&display=a")
temp <- read.csv(url,header=T)
data.list[[i]] <- temp
setTxtProgressBar(pb,i)
}
close(pb)
data <- rbindlist(data.list)
data$diff <- abs(targetHC-data$hc)
datatemp <- list()
for(year in unique(data$requestYear)){
datatemp[[year-1980]] <- data[which(requestYear==year&data$diff==min(data[which(requestYear==year)]$diff))]
}
thresholds <- rbindlist(datatemp)
return(thresholds)
}
povcal.threshold.national <- function(targetHC,year="all",lowerguess=0, upperguess=10,precision=0.005){
data.list <- list()
PLs <- seq(lowerguess,upperguess,by=precision)
pb <- txtProgressBar(min=0, max=length(PLs),style=3)
for (i in 1:length(PLs)){
param <- paste0("Countries=all&RefYears=",year,"&PovertyLine=",PLs[i])
url <- paste0("http://iresearch.worldbank.org/PovcalNet/PovcalNetAPI.ashx?",param,"&display=c")
temp <- read.csv(url,header=T)
data.list[[i]] <- temp
setTxtProgressBar(pb,i)
}
close(pb)
data <- rbindlist(data.list)
data$diff <- abs(targetHC-data$hc)
datatemp <- list()
i <- 1
for(country in (unique(data$CountryName))){
for(year in unique(data$requestYear)){
datatemp[[year-1980+36*(i-1)]] <- data[which(country==unique(data$CountryName)[i],requestYear==year&data$diff==min(data[which(requestYear==year)]$diff))]
}
i = i + 1
}
thresholds <- rbindlist(datatemp)
return(thresholds)
}
povcal.threshold.national <- function(targetHC,year="all",lowerguess=0, upperguess=10,precision=0.005){
data.list <- list()
PLs <- seq(lowerguess,upperguess,by=precision)
pb <- txtProgressBar(min=0, max=length(PLs),style=3)
for (i in 1:length(PLs)){
param <- paste0("Countries=all&RefYears=",year,"&PovertyLine=",PLs[i])
url <- paste0("http://iresearch.worldbank.org/PovcalNet/PovcalNetAPI.ashx?",param,"&display=c")
temp <- read.csv(url,header=T)
data.list[[i]] <- temp
setTxtProgressBar(pb,i)
}
close(pb)
data <- rbindlist(data.list)
data$diff <- abs(targetHC-data$hc)
datatemp <- list()
i <- 1
for(country in (unique(data$CountryName))){
for(year in unique(data$requestYear)){
datatemp[[year-1980+36*(i-1)]] <- data[which(country==unique(data$CountryName)[i],requestYear==year&data$diff==min(data[which(requestYear==year)]$diff))]
}
i = i + 1
}
thresholds <- rbindlist(datatemp)
return(thresholds)
}
data.list <- list()
PLs <- seq(lowerguess,upperguess,by=precision)
pb <- txtProgressBar(min=0, max=length(PLs),style=3)
for (i in 1:length(PLs)){
param <- paste0("Countries=all&RefYears=",year,"&PovertyLine=",PLs[i])
url <- paste0("http://iresearch.worldbank.org/PovcalNet/PovcalNetAPI.ashx?",param,"&display=c")
temp <- read.csv(url,header=T)
data.list[[i]] <- temp
setTxtProgressBar(pb,i)
}
data.list <- list()
PLs <- seq(lowerguess,upperguess,by=precision)
pb <- txtProgressBar(min=0, max=length(PLs),style=3)
for (i in 1:length(PLs)){
param <- paste0("Countries=all&RefYears=",year,"&PovertyLine=",PLs[i])
url <- paste0("http://iresearch.worldbank.org/PovcalNet/PovcalNetAPI.ashx?",param,"&display=c")
temp <- read.csv(url,header=T)
data.list[[i]] <- temp
setTxtProgressBar(pb,i)
}
close(pb)
data <- rbindlist(data.list)
data$diff <- abs(targetHC-data$hc)
datatemp <- list()
View(data)
data.list <- list()
PLs <- seq(lowerguess,upperguess,by=precision)
pb <- txtProgressBar(min=0, max=length(PLs),style=3)
for (i in 1:length(PLs)){
param <- paste0("Countries=all&RefYears=",year,"&PovertyLine=",PLs[i])
url <- paste0("http://iresearch.worldbank.org/PovcalNet/PovcalNetAPI.ashx?",param,"&display=c")
temp <- read.csv(url,header=T)
data.list[[i]] <- temp
setTxtProgressBar(pb,i)
}
close(pb)
data <- rbindlist(data.list)
data$diff <- abs(targetHC-data$hc)
datatemp <- list()
View(data)
data$diff <- abs(targetHC-data$HeadCount)
i <- 1
i <- 1
for(country in (unique(data$CountryName))){
for(year in unique(data$requestYear)){
datatemp[[year-1980+36*(i-1)]] <- data[which(country==unique(data$CountryName)[i],requestYear==year&data$diff==min(data[which(requestYear==year)]$diff))]
}
i = i + 1
}
thresholds <- rbindlist(datatemp)
for(country in (unique(data$CountryName))){
for(year in unique(data$RequestYear)){
datatemp[[year-1980+36*(i-1)]] <- data[which(country==unique(data$CountryName)[i],requestYear==year&data$diff==min(data[which(requestYear==year)]$diff))]
}
i = i + 1
}
thresholds <- rbindlist(datatemp)
return(thresholds)
i <- 1
for(country in (unique(data$CountryName))){
for(year in unique(data$RequestYear)){
datatemp[[year-1980+36*(i-1)]] <- data[which(country==unique(data$CountryName)[i],RequestYear==year&data$diff==min(data[which(RequestYear==year)]$diff))]
}
i = i + 1
}
thresholds <- rbindlist(datatemp)
return(thresholds)
View(thresholds)
unique(data$CountryName)
unique(data$CountryName)[1]
unique(data$CountryName)[2]
unique(data$CountryName)[2][1]
unique(data$CountryName)[[1]]
unique(data$CountryName)[,1]
unique(data$CountryName)[1,]
unique(data$CountryName)[1]
View(datatemp)
for(country in (unique(data$CountryName))){
for(year in unique(data$RequestYear)){
datatemp[[year-1980+36*(i-1)]] <- data[which(CountryName==country,RequestYear==year&data$diff==min(data[which(RequestYear==year&CountryName==country)]$diff))]
}
i = i + 1
}
thresholds <- rbindlist(datatemp)
warnings()
View(thresholds)
View(datatemp)
View(data.list)
View(datatemp)
for(country in (unique(data$CountryName))){
for(year in unique(data$RequestYear)){
datatemp[[year-1980+36*(i-1)]] <- data[which(CountryName==country&RequestYear==year&data$diff==min(data[which(RequestYear==year&CountryName==country)]$diff))]
}
i = i + 1
}
thresholds <- rbindlist(datatemp)
View(datatemp)
gc()
View(datatemp)
i <- 1
rm(thresholds)
rm(datatemp)
datatemp <- list()
i <- 1
for(country in (unique(data$CountryName))){
for(year in unique(data$RequestYear)){
datatemp[[year-1980+36*(i-1)]] <- data[which(CountryName==country&RequestYear==year&data$diff==min(data[which(RequestYear==year&CountryName==country)]$diff))]
}
i = i + 1
}
thresholds <- rbindlist(datatemp)
View(thresholds)
data[which(CountryName==Algeria&RequestYear==2015&data$diff==min(data[which(RequestYear==2015&CountryName==Algeria)]$diff))]
data[which(CountryName=="Algeria"&RequestYear==2015&data$diff==min(data[which(RequestYear==2015&CountryName=="Algeria")]$diff))]
i <- 1
for(country in unique(data$CountryName)){
for(year in unique(data$RequestYear)){
datatemp[[i]] <- data[which(CountryName==country&RequestYear==year&data$diff==min(data[which(RequestYear==year&CountryName==country)]$diff))]
i = i + 1
}
}
thresholds <- rbindlist(datatemp)
View(thresholds)
upperguess <- 5
upperguess <- 10
data.list <- list()
PLs <- seq(lowerguess,upperguess,by=precision)
pb <- txtProgressBar(min=0, max=length(PLs),style=3)
for (i in 1:length(PLs)){
param <- paste0("Countries=all&RefYears=",year,"&PovertyLine=",PLs[i])
url <- paste0("http://iresearch.worldbank.org/PovcalNet/PovcalNetAPI.ashx?",param,"&display=c")
temp <- read.csv(url,header=T)
data.list[[i]] <- temp
setTxtProgressBar(pb,i)
}
close(pb)
data <- rbindlist(data.list)
data$diff <- abs(targetHC-data$HeadCount)
datatemp <- list()
i <- 1
for(country in unique(data$CountryName)){
for(year in unique(data$RequestYear)){
datatemp[[i]] <- data[which(CountryName==country&RequestYear==year&data$diff==min(data[which(RequestYear==year&CountryName==country)]$diff))]
i = i + 1
}
}
thresholds <- rbindlist(datatemp)
View(thresholds)
View(thresholds)
thresholdsdt <- as.data.table(thresholds)
View(thresholdsdt)
thresholdsdt[thresholdsdt[, .I[PovertyLine == max(PovertyLine)], by=c(RequestYear, CountryName)]]
thresholdsdt[thresholdsdt[, .I[PovertyLine == max(PovertyLine)], by=c(RequestYear, CountryName)]$PovertyLine]
?'.I'
thresholdsdt[thresholdsdt[, .I[PovertyLine==max(PovertyLine)], by=CountryName]]
thresholdsdt[thresholdsdt[, .I[PovertyLine == max(PovertyLine)], by=CountryName]]
?data.table
thresholdsdt[, max(PovertyLine), by=CountryName]
thresholdsdt[, max(PovertyLine), by=c(CountryName,RequestYear)]
thresholdsdt[, max(PovertyLine), by=CountryName&RequestYear]
thresholdsdt$CountryYear <- paste0(thresholdsdt$CountryName,thresholdsdt$RequestYear)
thresholdsdt[, max(PovertyLine), by=CountryYear]
unique(data$RequestYear)
View(data)
thresholdsdt[, .I[max(PovertyLine)], by=CountryYear]
thresholdsdt[, .I[max(PovertyLine)], by=CountryYear]$V1
thresholdsdt[thresholdsdt[, .I[max(PovertyLine)], by=CountryYear]$V1]
thresholdsdt <- as.data.table(thresholds)
thresholdsdt$CountryYear <- paste0(thresholdsdt$CountryName,thresholdsdt$RequestYear)
thresholdsdt[thresholdsdt[, .I[max(PovertyLine)], by=CountryYear]$V1]
thresholdsdt$CountryYear <- paste0(thresholdsdt$CountryName,thresholdsdt$RequestYear)
thresholdsdt[thresholdsdt[, .I[PovertyLine==max(PovertyLine)], by=CountryYear]$V1]
P1.thresholds.national <- povcal.threshold.national(targetHC = 0.01, year="all", lowerguess=0, upperguess=10, precision=0.005)
